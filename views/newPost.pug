doctype
html
  head
    meta(charset='UTF-8')
    title TILote
    meta(name='viewport' content='width=device-width, user-scalable=no')
    meta(http-equiv='X-UA-Compatible' content='IE=edge')
    link(href='https://fonts.googleapis.com/css2?family=Righteous&display=swap' rel='stylesheet' type='text/css')
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css')
    script(src='https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js')
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/highlight.js/latest/styles/github.min.css')
    script(src='https://cdn.jsdelivr.net/highlight.js/latest/highlight.min.js')
    link(rel='stylesheet' href='/main.css')
  body
    header
      .header-container
        a#logo(href="/") TILote
        .header-buttons
          if user && user.id
            button#my-profile.btn(onclick=`location.href='/${user.id}'`) My TIL
            button.btn(onclick="location.href='/post'") 새 글
            button.btn(onclick="location.href='/auth/logout'") 로그아웃
          else
            button.btn(onclick="location.href='/login'") 로그인
            button.btn(onclick="location.href='/join'") 회원가입
    .container
      section.main-editor
        //- form.post-form(action='/post' method='post')
        .editor-title
          textarea#edit-title(placeholder='제목')
        .editor-tag
          textarea#edit-tag(placeholder='#태그명1 #태그명2')
        .editor
          textarea#md-editor
        .buttons
          button.btn#temp(disabled=true) 임시저장
          button.btn#publish(disabled=true) 등록
          span.title-error 제목을 입력하세요
      section.post-detail
        .private
          input#is-private(type='checkbox' name='private')
          | 나만 보이는 글
  script.
    var simplemde = new SimpleMDE({
      element: document.getElementById("md-editor"),
      autofocus: true,
      autoDownloadFontAwesome: true,
      forceSync: true,
      toolbar: ["bold", "italic", "strikethrough", "heading", "code", "quote", "unordered-list", "ordered-list", "link", "image", "table", "|", "preview", "guide"],
      placeholder: "Type here...",
      promptURLs: true,
      status: ["lines", "words", "cursor"],
      renderingConfig: {
        singleLineBreaks: false,
        codeSyntaxHighlighting: true
      },
      spellChecker: false,
      styleSelectedText: false,
      shortcuts: {
        "togglePreview": null,
      }
    });
    document.getElementById('edit-title').onkeyup = function() {
      if(this.value === '') {
        //- console.log('제목없음');
        document.querySelectorAll('.btn').forEach(function(btn) {
          btn.disabled = true;
          document.querySelector('.title-error').innerHTML = '제목을 입력하세요';
        });
      } else {
        //- console.log('제목있음');
        document.querySelectorAll('.btn').forEach(function(btn) {
          btn.disabled = false;
          document.querySelector('.title-error').innerHTML = '';
        });
      }
    };
    document.getElementById('temp').addEventListener('click', function() {
      var formData = new FormData();
      var title = document.getElementById('edit-title').value;
      const data = {
        "title": title,
        "content": simplemde.value(),
        "tag": document.getElementById('edit-tag').value,
        "is_private": document.getElementById('is-private').checked 
      }
      var xhr = new XMLHttpRequest();
      xhr.onload = function() {
        if(xhr.status === 200) {
          alert('임시저장 되었습니다.');
        }
        if(xhr.status === 403) {
          alert('로그인이 필요합니다.');
        }
      };
      xhr.open('POST', '/post/temp');
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify(data));      
    });
    document.getElementById('publish').addEventListener('click', function() {
      var formData = new FormData();
      var title = document.getElementById('edit-title').value;
      const data = {
        "title": title,
        "content": simplemde.value(),
        "tag": document.getElementById('edit-tag').value,
        "is_private": document.getElementById('is-private').checked 
      }
      var xhr = new XMLHttpRequest();
      xhr.onload = function() {
        if(xhr.status === 403) {
          alert('로그인이 필요합니다.');
        } else if(xhr.status === 201) {
          location.href = '/';
        }
      };
      xhr.open('POST', '/post');
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify(data));
    });